---
title: "ãƒ›ãƒ¼ãƒ ã§ã®ã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³ã®è¨­å®š"
date: 2025-01-15
tags:
  - Authentication
  - Cybersecurity
  - Homelab
categories:
  - Cybersecurity
lang: ja
excerpt: "ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã‚µãƒ¼ãƒ“ã‚¹ã®æ•°åã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†ã«ç–²ã‚Œã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³ã‚’è¨­å®šã—ã¦ã€1å›ã®ãƒ­ã‚°ã‚¤ãƒ³ã§ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã—ã‚‡ã†ã€‚"
thumbnail: /assets/security/lock.png
---

ã‚ãªãŸã¯å°è±¡çš„ãªãƒ›ãƒ¼ãƒ ãƒ©ãƒœã‚’æ§‹ç¯‰ã—ã¾ã—ãŸâ€”â€”Nextcloudã€Jellyfinã€Home Assistantã€Portainerã€Grafanaã€ãã—ã¦ä»–ã®åæ•°å€‹ã®ã‚µãƒ¼ãƒ“ã‚¹ã€‚ãã‚Œãã‚ŒãŒç´ æ™´ã‚‰ã—ã„ã§ã™ã€‚ã—ã‹ã—ã€ãã‚Œãã‚Œã«ç‹¬è‡ªã®ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã™ã€‚ãã—ã¦ç‹¬è‡ªã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€‚ãã—ã¦ç‹¬è‡ªã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€‚

èãè¦šãˆãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç–²åŠ´ã®ä¸–ç•Œã¸ã‚ˆã†ã“ãã€‚

ä¸€åº¦ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã ã‘ã§ã™ã¹ã¦ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããŸã‚‰ã©ã†ã§ã—ã‚‡ã†ã‹ï¼Ÿãã‚ŒãŒã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³ï¼ˆSSOï¼‰ã§ã‚ã‚Šã€ã‚‚ã¯ã‚„ä¼æ¥­å°‚ç”¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

## ãªãœãƒ›ãƒ¼ãƒ ã§ SSO ã‚’ä½¿ã†ã®ã‹ï¼Ÿ

**å•é¡Œï¼š**

- 15+ ã®ã‚µãƒ¼ãƒ“ã‚¹ = 15+ ã®è¦šãˆã‚‹ã¹ããƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆã¾ãŸã¯å†åˆ©ç”¨ ğŸ˜±ï¼‰
- å„ã‚µãƒ¼ãƒ“ã‚¹ã«å€‹åˆ¥ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨æ™‚é–“ã®ç„¡é§„
- é›†ä¸­å‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãŒãªã„
- å¿…è¦ãªã¨ãã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’å–ã‚Šæ¶ˆã™ã®ãŒå›°é›£
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã¯æ‚ªå¤¢

**è§£æ±ºç­–ï¼š**

SSO ãŒæä¾›ã™ã‚‹ã‚‚ã®ï¼š
- **1å›ã®ãƒ­ã‚°ã‚¤ãƒ³**ã§ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹
- **é›†ä¸­å‹èªè¨¼** - 1ã‹æ‰€ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç®¡ç†
- **ã‚ˆã‚Šè‰¯ã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** - MFA ã‚’ä¸€åº¦å¼·åˆ¶ã™ã‚Œã°ã€ã©ã“ã§ã‚‚é©ç”¨ã•ã‚Œã‚‹
- **ç°¡å˜ãªã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°** - å®¶æ—/å‹äººã‚’ä¸€åº¦ã«ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã«è¿½åŠ 
- **è¿…é€Ÿãªå–ã‚Šæ¶ˆã—** - 1ã¤ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç„¡åŠ¹ã«ã™ã‚Œã°ã€ã©ã“ã§ã‚‚ãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ

## SSO ã®åŸºç¤ã‚’ç†è§£ã™ã‚‹

### ã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³ã¨ã¯ï¼Ÿ

SSO ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã€å†èªè¨¼ãªã—ã§è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹èªè¨¼ã‚¹ã‚­ãƒ¼ãƒ ã§ã™ã€‚

**ç°¡å˜ãªä¾‹ï¼š**
- SSO ãªã—ï¼šNextcloud ã«ãƒ­ã‚°ã‚¤ãƒ³ â†’ Grafana ã«ãƒ­ã‚°ã‚¤ãƒ³ â†’ Jellyfin ã«ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆ3å›ã®ãƒ­ã‚°ã‚¤ãƒ³ï¼‰
- SSO ã‚ã‚Šï¼šä¸€åº¦ãƒ­ã‚°ã‚¤ãƒ³ â†’ 3ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã™ã¹ã¦ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆ1å›ã®ãƒ­ã‚°ã‚¤ãƒ³ï¼‰

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®èª¬æ˜

SSO ã‚’è¤‡æ•°ã® VIP ãƒ«ãƒ¼ãƒ ãŒã‚ã‚‹ãƒŠã‚¤ãƒˆã‚¯ãƒ©ãƒ–ã®ã‚ˆã†ã«è€ƒãˆã¦ãã ã•ã„ã€‚å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ†è§£ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

#### 1. ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆIdPï¼‰- ç”¨å¿ƒæ£’

**å½¹å‰²ï¼š**ã‚ãªãŸãŒèª°ã§ã‚ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ä¸­å¤®èªè¨¼æ©Ÿé–¢ã€‚

**ç¾å®Ÿä¸–ç•Œã®ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼ï¼š**ãƒŠã‚¤ãƒˆã‚¯ãƒ©ãƒ–ã®å…¥å£ã§ ID ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ãƒªã‚¹ãƒˆãƒãƒ³ãƒ‰ã‚’æ¸¡ã™ç”¨å¿ƒæ£’ã®ã‚ˆã†ãªã‚‚ã®ã€‚

**ã‚ãªãŸã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã§ã¯ï¼š**
- **Autheliaã€Authentikã€ã¾ãŸã¯ Keycloak** ãŒç”¨å¿ƒæ£’ã¨ã—ã¦æ©Ÿèƒ½
- ä»»æ„ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ã¾ãšã“ã“ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ MFA ã‚’ãƒã‚§ãƒƒã‚¯
- æ¤œè¨¼ã•ã‚Œã‚‹ã¨ã€ã€Œãƒˆãƒ¼ã‚¯ãƒ³ã€ï¼ˆãƒªã‚¹ãƒˆãƒãƒ³ãƒ‰ã®ã‚ˆã†ãªã‚‚ã®ï¼‰ãŒä¸ãˆã‚‰ã‚Œã¾ã™

**ãƒ•ãƒ­ãƒ¼ä¾‹ï¼š**
```
ã‚ãªãŸ â†’ Nextcloud ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹
Nextcloud â†’ ã€Œã‚ãªãŸã‚’çŸ¥ã‚Šã¾ã›ã‚“ã€ç”¨å¿ƒæ£’ã«èã„ã¦ãã ã•ã„ã€
ã‚ãªãŸ â†’ Authelia ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
Authelia â†’ ã€Œèªè¨¼æƒ…å ±ã‚’è¦‹ã›ã¦ãã ã•ã„ã€
ã‚ãªãŸ â†’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ + MFA ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›
Authelia â†’ ã€Œæ¤œè¨¼æ¸ˆã¿ï¼ã“ã‚ŒãŒã‚ãªãŸã®ãƒˆãƒ¼ã‚¯ãƒ³ã§ã™ã€
```

#### 2. ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆSPï¼‰- VIP ãƒ«ãƒ¼ãƒ 

**å½¹å‰²ï¼š**IdP ã‚’ä¿¡é ¼ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’èªè¨¼ã™ã‚‹å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

**ç¾å®Ÿä¸–ç•Œã®ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼ï¼š**ãƒŠã‚¤ãƒˆã‚¯ãƒ©ãƒ–ã® VIP ãƒ«ãƒ¼ãƒ ã®ã‚ˆã†ãªã‚‚ã®ã€‚ID ã¯ãƒã‚§ãƒƒã‚¯ã›ãšã€ç”¨å¿ƒæ£’ã‹ã‚‰ã®ãƒªã‚¹ãƒˆãƒãƒ³ãƒ‰ã ã‘ã‚’è¦‹ã¾ã™ã€‚

**ã‚ãªãŸã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã§ã¯ï¼š**
- **ã‚ãªãŸã®ã‚¢ãƒ—ãƒªï¼š**Nextcloudã€Grafanaã€Jellyfinã€Home Assistant
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªåˆ†ã§å‡¦ç†ã—ãªã„
- IdP ã®æ±ºå®šã‚’ä¿¡é ¼
- ã€ŒAuthelia ã‹ã‚‰ã®æœ‰åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒã£ã¦ã„ã¾ã™ã‹ï¼Ÿã€ã¨ã ã‘ãƒã‚§ãƒƒã‚¯

**ä¾‹ï¼š**
```
ã‚ãªãŸ â†’ Grafana ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆAuthelia ã‹ã‚‰ã®ãƒˆãƒ¼ã‚¯ãƒ³ä»˜ãï¼‰
Grafana â†’ ã€ŒAuthelia ã‹ã‚‰ã®æœ‰åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒã£ã¦ã„ã¾ã™ã­ã€
Grafana â†’ ã€ŒAuthelia ã«ã‚ˆã‚‹ã¨ã€ã‚ãªãŸã¯ 'admins' ã‚°ãƒ«ãƒ¼ãƒ—ã® 'alice' ã§ã™ã€
Grafana â†’ ã€Œã‚ˆã†ã“ãï¼ã€
```

#### 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª - ã‚²ã‚¹ãƒˆãƒªã‚¹ãƒˆ

**å½¹å‰²ï¼š**ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰ã‚’ä¿å­˜ã€‚

**ç¾å®Ÿä¸–ç•Œã®ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼ï¼š**ç”¨å¿ƒæ£’ãŒãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚²ã‚¹ãƒˆãƒªã‚¹ãƒˆã€‚

**ã‚ãªãŸã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã§ã¯ï¼š**
- **ã‚·ãƒ³ãƒ—ãƒ«ï¼š**ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€ YAML ãƒ•ã‚¡ã‚¤ãƒ«
- **é«˜åº¦ï¼š**LDAP ã‚µãƒ¼ãƒãƒ¼ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚ˆã†ãªã‚‚ã®ï¼‰
- å«ã¾ã‚Œã‚‹ã‚‚ã®ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ãƒ¡ãƒ¼ãƒ«ã€ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—

**æ§‹é€ ä¾‹ï¼š**
```yaml
users:
  alice:
    password: (hashed)
    email: alice@home.local
    groups: [admins, users]
  bob:
    password: (hashed)
    email: bob@home.local
    groups: [users]
```

#### 4. èªè¨¼ vs èªå¯

**èªè¨¼ï¼š**ã‚ãªãŸãŒèª°ã§ã‚ã‚‹ã‹ã‚’è¨¼æ˜ã™ã‚‹ï¼ˆã€Œã‚ãªãŸã¯ Alice ã§ã™ã‹ï¼Ÿã€ï¼‰
**èªå¯ï¼š**ã‚ãªãŸãŒä½•ãŒã§ãã‚‹ã‹ã‚’æ±ºå®šã™ã‚‹ï¼ˆã€ŒAlice ã¯ç®¡ç†ãƒ‘ãƒãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã‹ï¼Ÿã€ï¼‰

**ç¾å®Ÿä¸–ç•Œã®ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼ï¼š**
- **èªè¨¼** = 21æ­³ä»¥ä¸Šã§ã‚ã‚‹ã“ã¨ã‚’è¨¼æ˜ã™ã‚‹ãŸã‚ã« ID ã‚’æç¤ºã™ã‚‹
- **èªå¯** = ç”¨å¿ƒæ£’ãŒ VIP ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«å…¥ã‚Œã‚‹ã‹ã©ã†ã‹ã‚’æ±ºå®šã™ã‚‹

**SSO ã§ã¯ï¼š**
- **IdP ãŒèªè¨¼ã‚’å‡¦ç†ï¼š**ã€Œã¯ã„ã€ã“ã‚Œã¯æ­£ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æŒã¤ Alice ã§ã™ã€
- **ã‚¢ãƒ—ãƒªãŒèªå¯ã‚’å‡¦ç†ï¼š**ã€ŒAlice ã¯ 'admins' ã‚°ãƒ«ãƒ¼ãƒ—ã«ã„ã‚‹ã®ã§ã€ç®¡ç†è€…ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¾ã™ã€

#### 5. èªè¨¼ãƒ—ãƒ­ãƒˆã‚³ãƒ« - è¨€èª

**å½¹å‰²ï¼š**IdP ã¨ã‚¢ãƒ—ãƒªãŒé€šä¿¡ã™ã‚‹ãŸã‚ã®æ¨™æº–åŒ–ã•ã‚ŒãŸæ–¹æ³•ã€‚

**ç¾å®Ÿä¸–ç•Œã®ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼ï¼š**ç”¨å¿ƒæ£’ã¨ VIP ãƒ«ãƒ¼ãƒ ãŒé€šä¿¡ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ç•°ãªã‚‹è¨€èªã®ã‚ˆã†ãªã‚‚ã®ã€‚

**OIDCï¼ˆOpenID Connectï¼‰- ãƒ¢ãƒ€ãƒ³ã§æ¨å¥¨ï¼š**
- **èªè¨¼ï¼š**ã€Œã‚ãªãŸã¯èª°ã§ã™ã‹ï¼Ÿã€
- **èªå¯ï¼š**ã€Œã©ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«æ‰€å±ã—ã¦ã„ã¾ã™ã‹ï¼Ÿã€
- JSON ã‚’ä½¿ç”¨ï¼ˆèª­ã¿ã‚„ã™ã„ï¼‰
- OAuth2 ä¸Šã«æ§‹ç¯‰
- ã»ã¨ã‚“ã©ã®ãƒ¢ãƒ€ãƒ³ãªã‚¢ãƒ—ãƒªãŒã‚µãƒãƒ¼ãƒˆ
- **å¯èƒ½ãªé™ã‚Šã“ã‚Œã‚’ä½¿ç”¨**

**OIDC ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¾‹ï¼š**
```json
{
  "sub": "alice",
  "email": "alice@homelab.local",
  "groups": ["admins", "users"],
  "exp": 1705334400
}
```

**SAML - ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ¨™æº–ï¼š**
- æ­£å¼ãªæ³•å¾‹ç”¨èªã‚’è©±ã™ã‚ˆã†ãªã‚‚ã®
- XML ã‚’ä½¿ç”¨ï¼ˆå†—é•·ï¼‰
- å¤ã„ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒªãŒä½¿ç”¨
- ã‚ˆã‚Šè¤‡é›‘ã ãŒåºƒãã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹
- ä¼æ¥­ç’°å¢ƒã§ä¸€èˆ¬çš„

**Windows çµ±åˆèªè¨¼ï¼ˆWIAï¼‰- Windows ã®ã¿ï¼š**
- Kerberos/NTLM ã‚’ä½¿ç”¨
- Windows ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³
- ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸Šã§ã‚ã‚Œã°ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãªã—
- **ä»¥ä¸‹ã§ã®ã¿å‹•ä½œï¼š**Active Directory + Windows ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- **ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãªã„** - å¤–éƒ¨ SaaS ã‚¢ãƒ—ãƒªã¨çµ±åˆã§ããªã„
- **ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã«ã¯ä¸é©åˆ‡**ã€Windows Server ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆã‚’é™¤ã

#### 6. ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ vs éãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³èªè¨¼

**ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ï¼Ÿ**

ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ç•°ãªã‚‹çµ„ç¹”/ã‚·ã‚¹ãƒ†ãƒ ãŒäº’ã„ã®èªè¨¼ã‚’ä¿¡é ¼ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

**ç¾å®Ÿä¸–ç•Œã®ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼ï¼š**
- **éãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼š**ã‚¸ãƒ ã®ä¼šå“¡è³‡æ ¼ã¯è‡ªåˆ†ã®ã‚¸ãƒ ã§ã®ã¿æœ‰åŠ¹
- **ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼š**ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã¯è¤‡æ•°ã®å›½ã§æœ‰åŠ¹ï¼ˆäº’ã„ã«ä¿¡é ¼ã—ã¦ã„ã‚‹ï¼‰

**éãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³èªè¨¼ï¼ˆWIAã€åŸºæœ¬èªè¨¼ï¼‰ï¼š**
```
ã‚ãªãŸã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒœ IdP â†’ ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã‚µãƒ¼ãƒ“ã‚¹ã§ã®ã¿å‹•ä½œ
âŒ å¤–éƒ¨ SaaSï¼ˆGitHubã€AWS ãªã©ï¼‰ã«èªè¨¼ã§ããªã„
```

**ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³èªè¨¼ï¼ˆOIDCã€SAMLï¼‰ï¼š**
```
ã‚ãªãŸã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒœ IdP â†” å¤–éƒ¨ SaaSï¼ˆã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹å ´åˆï¼‰
âœ… ã‚ãªãŸã® IdP ã‚’ä¿¡é ¼ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã«èªè¨¼ã§ãã‚‹
```

**ã‚·ãƒŠãƒªã‚ªä¾‹ï¼š**

**éãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆWIAï¼‰ï¼š**
```
ã‚ãªãŸ â†’ Windows ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ â†’ ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã‚¢ãƒ—ãƒª âœ…
ã‚ãªãŸ â†’ Windows ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ â†’ GitHub âŒï¼ˆGitHub ã¯ã‚ãªãŸã® DC ã‚’ä¿¡é ¼ã—ãªã„ï¼‰
```

**ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆOIDC/SAMLï¼‰ï¼š**
```
ã‚ãªãŸ â†’ Authentik â†’ ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã‚¢ãƒ—ãƒª âœ…
ã‚ãªãŸ â†’ Authentik â†’ GitHub Enterprise âœ…ï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
ã‚ãªãŸ â†’ Authentik â†’ AWS âœ…ï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
```

**ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã®è½ã¨ã—ç©´ï¼š**

ã»ã¨ã‚“ã©ã® SaaS ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¯**ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³**ã§ã®ã¿ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆï¼š

| ã‚µãƒ¼ãƒ“ã‚¹ | ç„¡æ–™/å€‹äºº | ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º |
|---------|---------------|--------------|
| **GitHub** | SSO ãªã— | SAML ã«ã‚ˆã‚‹ SSO |
| **AWS** | SSO ãªã— | SAML ã«ã‚ˆã‚‹ SSO |
| **Google Workspace** | SSO ãªã— | SAML ã«ã‚ˆã‚‹ SSO |
| **Microsoft 365** | SSO ãªã— | SAML ã«ã‚ˆã‚‹ SSO |
| **Slack** | SSO ãªã— | SAML ã«ã‚ˆã‚‹ SSO |

**ã‚³ã‚¹ãƒˆã®ç¾å®Ÿï¼š**
- GitHub Enterpriseï¼š$21/ãƒ¦ãƒ¼ã‚¶ãƒ¼/æœˆ
- AWS SSOï¼šAWS Organizations ãŒå¿…è¦
- Google Workspaceï¼š$12-18/ãƒ¦ãƒ¼ã‚¶ãƒ¼/æœˆï¼ˆSSO ç”¨ï¼‰
- Microsoft 365ï¼š$22/ãƒ¦ãƒ¼ã‚¶ãƒ¼/æœˆï¼ˆSSO ç”¨ï¼‰

!!!warning "âš ï¸ ãƒ›ãƒ¼ãƒ ãƒ©ãƒœ SSO ã®åˆ¶é™"
    **ã‚ãªãŸã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒœ SSO ãŒå‹•ä½œã™ã‚‹ã‚‚ã®ï¼š**
    - âœ… ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒ“ã‚¹ï¼ˆNextcloudã€Grafanaã€Jellyfinï¼‰
    - âœ… ã‚ãªãŸãŒç®¡ç†ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹
    - âœ… åˆ¶é™ãªã—ã§ OIDC/SAML ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚¢ãƒ—ãƒª
    
    **ã‚ãªãŸã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒœ SSO ãŒå‹•ä½œã—ãªã„ã‚‚ã®ï¼š**
    - âŒ ç„¡æ–™ãƒ†ã‚£ã‚¢ SaaSï¼ˆGitHubã€Gmailã€Slackï¼‰
    - âŒ ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒå¿…è¦ãªã‚µãƒ¼ãƒ“ã‚¹
    - âŒ ã‚«ã‚¹ã‚¿ãƒ  IdP ã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„ã‚µãƒ¼ãƒ“ã‚¹
    
    **ã“ã‚Œã«ã‚ˆã‚Šãƒ›ãƒ¼ãƒ ãƒ©ãƒœ SSO ã¯å†…éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ã¿ã«åˆ¶é™ã•ã‚Œã¾ã™**ãŒã€10-20 ã®ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªã‚’ç®¡ç†ã™ã‚‹ã«ã¯ä¾ç„¶ã¨ã—ã¦ä¾¡å€¤ãŒã‚ã‚Šã¾ã™ï¼

**æ¯”è¼ƒï¼š**

| ãƒ—ãƒ­ãƒˆã‚³ãƒ« | æœ€é©ãªç”¨é€” | è¤‡é›‘ã• | ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | ãƒ›ãƒ¼ãƒ ãƒ©ãƒœãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ |
|----------|----------|------------|-----------|------------------|
| **OIDC** | ãƒ¢ãƒ€ãƒ³ã‚¢ãƒ—ãƒª | ä½ | âœ… ã¯ã„ | âœ… ã¯ã„ |
| **SAML** | ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒª | é«˜ | âœ… ã¯ã„ | âš ï¸ å¿…è¦ãªå ´åˆ |
| **WIA** | Windows ãƒ‰ãƒ¡ã‚¤ãƒ³ | ä¸­ | âŒ ã„ã„ãˆ | âŒ éå‰° |

!!!tip "ğŸ’¡ ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®é¸æŠ"
    ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã®å ´åˆï¼š
    - **OIDC ã‚’ä½¿ç”¨** ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚¢ãƒ—ãƒªç”¨ï¼ˆGrafanaã€Nextcloudã€Portainerï¼‰
    - **ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚’ä½¿ç”¨**ï¼ˆAutheliaï¼‰OIDC ã‚µãƒãƒ¼ãƒˆã®ãªã„ã‚¢ãƒ—ãƒªç”¨
    - **WIA ã‚’ã‚¹ã‚­ãƒƒãƒ—** ã™ã§ã« Active Directory ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆã‚’é™¤ãï¼ˆãã—ã¦ SaaS ã§ã¯å‹•ä½œã—ãªã„ï¼‰
    - **SAML ã‚’ä½¿ç”¨** ç‰¹å®šã®ã‚¢ãƒ—ãƒªãŒå¿…è¦ã¨ã™ã‚‹å ´åˆã®ã¿
    - **åˆ¶é™ã‚’å—ã‘å…¥ã‚Œã‚‹ï¼š**ã‚ãªãŸã® SSO ã¯ç„¡æ–™ãƒ†ã‚£ã‚¢ SaaSï¼ˆGitHubã€Gmail ãªã©ï¼‰ã§ã¯å‹•ä½œã—ãªã„

**è¦–è¦šçš„æ¯”è¼ƒï¼š**

{% mermaid %}flowchart LR
    A["ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼"] -->|"1. ãƒ­ã‚°ã‚¤ãƒ³ãƒªã‚¯ã‚¨ã‚¹ãƒˆ"| B["ğŸ” IdP<br/>(Authelia)"]
    B -->|"2. èªè¨¼æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯"| C["ğŸ“š ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª<br/>(YAML/LDAP)"]
    C -->|"3. æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼"| B
    B -->|"4. ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ<br/>(OIDC/SAML)"| A
    A -->|"5. ãƒˆãƒ¼ã‚¯ãƒ³æç¤º"| D["ğŸ“¦ ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼<br/>(Nextcloud)"]
    D -->|"6. ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼"| B
    B -->|"7. ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹"| D
    D -->|"8. ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯"| A
    
    style B fill:#e3f2fd
    style C fill:#f3e5f5
    style D fill:#e8f5e9
{% endmermaid %}

#### ã™ã¹ã¦ã‚’ã¾ã¨ã‚ã‚‹

**SSO ãªã—ï¼ˆç¾åœ¨ã®çŠ¶æ…‹ï¼‰ï¼š**
```
ã‚ãªãŸ â†’ Nextcloud â†’ Nextcloud ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
ã‚ãªãŸ â†’ Grafana â†’ Grafana ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
ã‚ãªãŸ â†’ Jellyfin â†’ Jellyfin ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
ï¼ˆ15 ã®ã‚µãƒ¼ãƒ“ã‚¹ = 15 ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ï¼‰
```

**SSO ã‚ã‚Šï¼ˆè¨­å®šå¾Œï¼‰ï¼š**
```
ã‚ãªãŸ â†’ Nextcloud â†’ Authelia ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ â†’ ä¸€åº¦ãƒ­ã‚°ã‚¤ãƒ³
ã‚ãªãŸ â†’ Grafana â†’ ã™ã§ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ãŒå­˜åœ¨ï¼‰
ã‚ãªãŸ â†’ Jellyfin â†’ ã™ã§ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ãŒå­˜åœ¨ï¼‰
ï¼ˆ1å›ã®ãƒ­ã‚°ã‚¤ãƒ³ = ã™ã¹ã¦ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼ï¼‰
```

**é­”æ³•ï¼š**Authelia ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªãŒ Authelia ã«ç¢ºèªã—ã¾ã™ï¼šã€Œã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã™ã‹ï¼Ÿã€Authelia ãŒã€Œã¯ã„ï¼ã€ã¨ç­”ãˆã€ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¾ã™ã€‚

!!!anote "ğŸ¯ é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ"
    - **IdPï¼ˆAutheliaï¼‰** = ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹å”¯ä¸€ã®å ´æ‰€
    - **ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆã‚ãªãŸã®ã‚¢ãƒ—ãƒªï¼‰** = IdP ã®æ±ºå®šã‚’ä¿¡é ¼
    - **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª** = ãƒ¦ãƒ¼ã‚¶ãƒ¼å/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¿å­˜ã•ã‚Œã‚‹å ´æ‰€
    - **ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ˆOIDC/SAMLï¼‰** = äº’ã„ã«é€šä¿¡ã™ã‚‹æ–¹æ³•
    
    IdP ã§ä¸€åº¦ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚Œã°ã€ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªãŒãã®ãƒ­ã‚°ã‚¤ãƒ³ã‚’ä¿¡é ¼ã—ã¾ã™ã€‚


## ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ vs å¤–éƒ¨ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«é£›ã³è¾¼ã‚€å‰ã«ã€ã€Œãªãœ Googleã€Microsoftã€ã¾ãŸã¯ GitHub ã‚’ IdP ã¨ã—ã¦ä½¿ã‚ãªã„ã®ã‹ï¼Ÿã€ã¨ç–‘å•ã«æ€ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### å¤–éƒ¨ IdPï¼ˆGoogleã€Microsoftã€GitHubã€Auth0ï¼‰

**é•·æ‰€ï¼š**
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸è¦
- ã™ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹
- ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- å€‹äººä½¿ç”¨ã¯ç„¡æ–™
- çµ„ã¿è¾¼ã¿ MFA
- **SaaS ã¨ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½**ï¼ˆã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆï¼‰

**çŸ­æ‰€ï¼š**
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã®æ‡¸å¿µ** - å¤–éƒ¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãŒãƒ›ãƒ¼ãƒ ãƒ©ãƒœã¸ã®ã™ã¹ã¦ã®ãƒ­ã‚°ã‚¤ãƒ³ã‚’è¦‹ã‚‹
- **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¾å­˜** - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãŒãƒ€ã‚¦ãƒ³ã™ã‚‹ã¨èªè¨¼ã§ããªã„
- **ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢** - ã‚µãƒ¼ãƒ“ã‚¹ãŒãƒ€ã‚¦ãƒ³ã™ã‚‹ã¨ãƒ›ãƒ¼ãƒ ãƒ©ãƒœãŒå£Šã‚Œã‚‹
- **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒªãƒ³ã‚¯** - å¤–éƒ¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãªã—ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã§ããªã„
- **åˆ©ç”¨è¦ç´„** - å½¼ã‚‰ã®ãƒ«ãƒ¼ãƒ«ã¨å¤‰æ›´ã«å¾“ã†
- **ãƒ‡ãƒ¼ã‚¿ä¸»æ¨©** - èªè¨¼ãƒ‡ãƒ¼ã‚¿ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’é›¢ã‚Œã‚‹
- **ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã«åˆ¶é™** - Google SSO ã‚’ Microsoft ã‚µãƒ¼ãƒ“ã‚¹ã«ä½¿ç”¨ã§ããªã„

### ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ IdPï¼ˆAutheliaã€Authentikã€Keycloakï¼‰

**é•·æ‰€ï¼š**
- **å®Œå…¨ãªãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼** - å¤–éƒ¨è¿½è·¡ãªã—
- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§å‹•ä½œ** - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆåœæ­¢ãŒãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã«å½±éŸ¿ã—ãªã„
- **å®Œå…¨ãªåˆ¶å¾¡** - ã‚ãªãŸã®ãƒ«ãƒ¼ãƒ«ã€ã‚ãªãŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼** - Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å¿…è¦ã¨ã›ãšã«å®¶æ—/å‹äººã‚’è¿½åŠ 
- **ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ãªã—** - èªè¨¼ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’æ‰€æœ‰
- **å­¦ç¿’æ©Ÿä¼š** - SSO ã®ä»•çµ„ã¿ã‚’ç†è§£
- **ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ãƒˆã‚³ãƒ«** - OIDC/SAML ã‚’ä½¿ç”¨ï¼ˆæ¨™æº–ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‰

**çŸ­æ‰€ï¼š**
- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå¿…è¦
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«è²¬ä»»ã‚’æŒã¤
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ã€ŒGoogle ã§ãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚ˆã‚Šè¤‡é›‘
- **SaaS çµ±åˆãŒåˆ¶é™ã•ã‚Œã‚‹** - ã»ã¨ã‚“ã©ã® SaaS ã¯é«˜ä¾¡ãªã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ—ãƒ©ãƒ³ãŒå¿…è¦

### ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

ä¸¡æ–¹ã®é•·æ‰€ã‚’æ´»ã‹ã™ï¼š

```yaml
# Authentik ã¯å¤–éƒ¨ IdP ã‚’ã‚½ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ç”¨å¯èƒ½
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯é¸æŠã§ãã‚‹ï¼šãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ OR Google OR GitHub
```

**ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼š**
- **ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã‚’ãƒ—ãƒ©ã‚¤ãƒãƒª** + å¤–éƒ¨ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- **å®¶æ—ç”¨ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ** + ã‚²ã‚¹ãƒˆç”¨ã®å¤–éƒ¨
- **æ©Ÿå¯†ã‚µãƒ¼ãƒ“ã‚¹ç”¨ã®ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ** + ä½ãƒªã‚¹ã‚¯ã‚¢ãƒ—ãƒªç”¨ã®å¤–éƒ¨

!!!tip "ğŸ’¡ å¤–éƒ¨ IdP ã‚’ä½¿ç”¨ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°"
    å¤–éƒ¨ IdP ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼š
    - Google/Microsoft ã«ãƒ­ã‚°ã‚¤ãƒ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’è¦‹ã‚‰ã‚Œã¦ã‚‚æ§‹ã‚ãªã„
    - ãƒ›ãƒ¼ãƒ ãƒ©ãƒœãŒå¸¸ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹
    - è‡ªåˆ†ã ã‘ã®èªè¨¼ãŒå¿…è¦
    - ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸è¦ã‚’æœ›ã‚€
    - ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€SaaS ã¨çµ±åˆã—ãŸã„
    
    ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼š
    - ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãŒé‡è¦ï¼ˆå¤–éƒ¨è¿½è·¡ãªã—ï¼‰
    - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ãŒå¿…è¦
    - è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆå®¶æ—/å‹äººï¼‰ã‚’ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
    - ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’å­¦ã³ã€åˆ¶å¾¡ã—ãŸã„
    - å¤–éƒ¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å…¬é–‹ã™ã¹ãã§ãªã„ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã‚‹
    - **ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã®ã¿ã« SSO ãŒå¿…è¦**ï¼ˆä¸€èˆ¬çš„ãªãƒ›ãƒ¼ãƒ ãƒ©ãƒœã®ã‚±ãƒ¼ã‚¹ï¼‰

**å®Ÿä¸–ç•Œã®ä¾‹ï¼š**

**ã‚·ãƒŠãƒªã‚ª 1 - ISP åœæ­¢ï¼š**
å¤–éƒ¨ IdP ã§ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã® Home Assistant ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚«ãƒ¡ãƒ©ã‚’ãƒã‚§ãƒƒã‚¯ã§ãã¾ã›ã‚“ã€‚ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ SSO ã§ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§ã™ã¹ã¦ãŒå‹•ä½œã—ã¾ã™ã€‚

**ã‚·ãƒŠãƒªã‚ª 2 - SaaS çµ±åˆï¼š**
ãƒ›ãƒ¼ãƒ ãƒ©ãƒœ SSO ã‚’ GitHub ã«ä½¿ç”¨ã—ãŸã„ã€‚GitHub ã¯ã‚«ã‚¹ã‚¿ãƒ  SAML IdP ã‚’å—ã‘å…¥ã‚Œã‚‹ãŸã‚ã« Enterpriseï¼ˆ$21/ãƒ¦ãƒ¼ã‚¶ãƒ¼/æœˆï¼‰ãŒå¿…è¦ã§ã™ã€‚ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã«ã¯é«˜ã™ãã‚‹ãŸã‚ã€ä»£ã‚ã‚Šã« GitHub è‡ªèº«ã®èªè¨¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

## SSO ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®é¸æŠ

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ 1ï¼šAutheliaï¼ˆè»½é‡ã€ãƒ—ãƒ­ã‚­ã‚·ãƒ™ãƒ¼ã‚¹ï¼‰

**æœ€é©ãªç”¨é€”ï¼š**ã‚·ãƒ³ãƒ—ãƒ«ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ãƒ¦ãƒ¼ã‚¶ãƒ¼

**é•·æ‰€ï¼š**
- è»½é‡ï¼ˆå˜ä¸€ãƒã‚¤ãƒŠãƒªï¼‰
- ä»»æ„ã®ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã§å‹•ä½œï¼ˆTraefikã€nginxï¼‰
- ã‚·ãƒ³ãƒ—ãƒ«ãª YAML è¨­å®š
- çµ„ã¿è¾¼ã¿ LDAP/ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹èªè¨¼
- å„ªã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**çŸ­æ‰€ï¼š**
- é™å®šçš„ãª OIDC ã‚µãƒãƒ¼ãƒˆï¼ˆåŸºæœ¬ï¼‰
- ç®¡ç† UI ãªã—ï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰
- Authentik ã‚ˆã‚Šçµ±åˆãŒå°‘ãªã„

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ 2ï¼šAuthentikï¼ˆãƒ•ãƒ«æ©Ÿèƒ½ã€ãƒ¢ãƒ€ãƒ³ï¼‰

**æœ€é©ãªç”¨é€”ï¼š**è¤‡é›‘ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€è¤‡æ•°ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒå¿…è¦

**é•·æ‰€ï¼š**
- ç¾ã—ã„ç®¡ç† UI
- å®Œå…¨ãª OIDC ãŠã‚ˆã³ SAML ã‚µãƒãƒ¼ãƒˆ
- çµ„ã¿è¾¼ã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
- ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼
- æ´»ç™ºãªé–‹ç™º

**çŸ­æ‰€ï¼š**
- ã‚ˆã‚Šé‡ã„ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨
- ã‚ˆã‚Šè¤‡é›‘ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- PostgreSQL/Redis ãŒå¿…è¦

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ 3ï¼šKeycloakï¼ˆã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ï¼‰

**æœ€é©ãªç”¨é€”ï¼š**å¤§è¦æ¨¡ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½

**é•·æ‰€ï¼š**
- æ¥­ç•Œæ¨™æº–
- åŒ…æ‹¬çš„ãªæ©Ÿèƒ½
- å„ªã‚ŒãŸ SAML/OIDC ã‚µãƒãƒ¼ãƒˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

**çŸ­æ‰€ï¼š**
- é‡ã„ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨ï¼ˆJava ãƒ™ãƒ¼ã‚¹ï¼‰
- è¤‡é›‘ãªè¨­å®š
- å°è¦æ¨¡ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã«ã¯éå‰°

### æ¯”è¼ƒè¡¨

| æ©Ÿèƒ½ | Authelia | Authentik | Keycloak |
|---------|----------|-----------|----------|
| **ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨** | ä½ | ä¸­ | é«˜ |
| **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®è¤‡é›‘ã•** | ä½ | ä¸­ | é«˜ |
| **OIDC ã‚µãƒãƒ¼ãƒˆ** | åŸºæœ¬ | å®Œå…¨ | å®Œå…¨ |
| **SAML ã‚µãƒãƒ¼ãƒˆ** | âŒ ãªã— | âœ… ã‚ã‚Š | âœ… ã‚ã‚Š |
| **ç®¡ç† UI** | âŒ ãªã— | âœ… ã‚ã‚Š | âœ… ã‚ã‚Š |
| **MFA** | âœ… TOTPã€WebAuthn | âœ… TOTPã€WebAuthnã€Passkey | âœ… ã™ã¹ã¦ã®ã‚¿ã‚¤ãƒ— |
| **æœ€é©ãªç”¨é€”** | å°è¦æ¨¡ãƒ©ãƒœ | ä¸­è¦æ¨¡ãƒ©ãƒœ | ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º |

!!!tip "ğŸ’¡ æ¨å¥¨"
    - Traefik/nginx ã‚’ä½¿ç”¨ã—ã¦ã„ã¦ã‚·ãƒ³ãƒ—ãƒ«ã•ã‚’æ±‚ã‚ã‚‹ãªã‚‰ **Authelia ã‹ã‚‰å§‹ã‚ã‚‹**
    - OIDC/SAML ã¨ UI ãŒå¿…è¦ãªã‚‰ **Authentik ã‚’é¸æŠ**
    - ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½ãŒå¿…è¦ã‹ã€ã™ã§ã«çŸ¥ã£ã¦ã„ã‚‹å ´åˆã®ã¿ **Keycloak ã‚’ä½¿ç”¨**


## Authelia ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

{% mermaid %}flowchart TD
  User["ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼"]
  Proxy["ğŸšª ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚· (Traefik/nginx)"]
  Authelia["ğŸ” Authelia"]
  LDAP["ğŸ“š ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª (YAML/LDAP)"]
  
  subgraph Services[" "]
    App1["ğŸ“¦ Nextcloud"]
    App2["ğŸ¬ Jellyfin"]
    App3["ğŸ“Š Grafana"]
  end
  
  User --> Proxy
  Proxy --> Authelia
  Proxy --> Services
  Authelia -.-> LDAP
  
  style Authelia fill:#e3f2fd
  style Proxy fill:#fff3e0
  style LDAP fill:#f3e5f5
  style Services fill:#e8f5e9
{% endmermaid %}

### å‰ææ¡ä»¶

- Docker ã¨ Docker Compose
- ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ï¼ˆTraefik ã¾ãŸã¯ nginxï¼‰
- ãƒ‰ãƒ¡ã‚¤ãƒ³åï¼ˆã¾ãŸã¯ãƒ­ãƒ¼ã‚«ãƒ« DNSï¼‰

### ã‚¹ãƒ†ãƒƒãƒ— 1ï¼šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®ä½œæˆ

```bash
mkdir -p authelia/{config,secrets}
cd authelia
```

### ã‚¹ãƒ†ãƒƒãƒ— 2ï¼šã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ç”Ÿæˆ

```bash
# JWT ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ
tr -cd '[:alnum:]' < /dev/urandom | fold -w "64" | head -n 1 > secrets/jwt_secret

# ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ
tr -cd '[:alnum:]' < /dev/urandom | fold -w "64" | head -n 1 > secrets/session_secret

# ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æš—å·åŒ–ã‚­ãƒ¼
tr -cd '[:alnum:]' < /dev/urandom | fold -w "64" | head -n 1 > secrets/storage_encryption_key
```

### ã‚¹ãƒ†ãƒƒãƒ— 3ï¼šè¨­å®šã®ä½œæˆ

```yaml
# config/configuration.yml
---
theme: dark
default_2fa_method: "totp"

server:
  host: 0.0.0.0
  port: 9091

log:
  level: info

totp:
  issuer: homelab.local
  period: 30
  skew: 1

authentication_backend:
  file:
    path: /config/users_database.yml
    password:
      algorithm: argon2id
      iterations: 1
      salt_length: 16
      parallelism: 8
      memory: 64

access_control:
  default_policy: deny
  rules:
    - domain: "*.homelab.local"
      policy: two_factor

session:
  name: authelia_session
  domain: homelab.local
  expiration: 1h
  inactivity: 5m
  remember_me_duration: 1M

regulation:
  max_retries: 3
  find_time: 2m
  ban_time: 5m

storage:
  encryption_key_secret_file: /secrets/storage_encryption_key
  local:
    path: /config/db.sqlite3

notifier:
  filesystem:
    filename: /config/notification.txt
```

### ã‚¹ãƒ†ãƒƒãƒ— 4ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ

```yaml
# config/users_database.yml
users:
  alice:
    displayname: "Alice Smith"
    password: "$argon2id$v=19$m=65536,t=3,p=4$..." # ç”Ÿæˆï¼šauthelia crypto hash generate argon2 --password 'yourpassword'
    email: alice@homelab.local
    groups:
      - admins
      - users
  
  bob:
    displayname: "Bob Jones"
    password: "$argon2id$v=19$m=65536,t=3,p=4$..."
    email: bob@homelab.local
    groups:
      - users
```

**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã®ç”Ÿæˆï¼š**

```bash
docker run --rm authelia/authelia:latest authelia crypto hash generate argon2 --password 'yourpassword'
```

### ã‚¹ãƒ†ãƒƒãƒ— 5ï¼šDocker Compose

```yaml
# docker-compose.yml
version: '3.8'

services:
  authelia:
    image: authelia/authelia:latest
    container_name: authelia
    volumes:
      - ./config:/config
      - ./secrets:/secrets
    ports:
      - 9091:9091
    environment:
      - TZ=America/New_York
    restart: unless-stopped
```

### ã‚¹ãƒ†ãƒƒãƒ— 6ï¼šTraefik ã¨ã®çµ±åˆ

```yaml
# docker-compose.ymlï¼ˆæ—¢å­˜ã® Traefik ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«è¿½åŠ ï¼‰
services:
  authelia:
    image: authelia/authelia:latest
    container_name: authelia
    volumes:
      - ./authelia/config:/config
      - ./authelia/secrets:/secrets
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.authelia.rule=Host(`auth.homelab.local`)"
      - "traefik.http.routers.authelia.entrypoints=websecure"
      - "traefik.http.routers.authelia.tls=true"
      - "traefik.http.services.authelia.loadbalancer.server.port=9091"
      
      # Authelia ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
      - "traefik.http.middlewares.authelia.forwardauth.address=http://authelia:9091/api/verify?rd=https://auth.homelab.local"
      - "traefik.http.middlewares.authelia.forwardauth.trustForwardHeader=true"
      - "traefik.http.middlewares.authelia.forwardauth.authResponseHeaders=Remote-User,Remote-Groups,Remote-Name,Remote-Email"
    restart: unless-stopped

  # ä¿è­·ã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã®ä¾‹
  nextcloud:
    image: nextcloud:latest
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.nextcloud.rule=Host(`nextcloud.homelab.local`)"
      - "traefik.http.routers.nextcloud.entrypoints=websecure"
      - "traefik.http.routers.nextcloud.tls=true"
      - "traefik.http.routers.nextcloud.middlewares=authelia@docker"
    restart: unless-stopped
```

### ã‚¹ãƒ†ãƒƒãƒ— 7ï¼šã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•

```bash
docker-compose up -d
```

`https://auth.homelab.local` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¾ã™ã€‚

### èªè¨¼ãƒ•ãƒ­ãƒ¼ã®ç†è§£

Authelia ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ãŸã®ã§ã€ä¿è­·ã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã¨ãã«ä½•ãŒèµ·ã“ã‚‹ã‹ã‚’æ­£ç¢ºã«è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

{% mermaid %}sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant App as ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (Nextcloud)
    participant SSO as SSO ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ (Authelia)
    participant LDAP as ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª (YAML/LDAP)
    
    User->>App: 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹
    App->>User: 2. SSO ãƒ­ã‚°ã‚¤ãƒ³ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    User->>SSO: 3. èªè¨¼æƒ…å ± + MFA ã‚’å…¥åŠ›
    SSO->>LDAP: 4. èªè¨¼æƒ…å ±ã‚’æ¤œè¨¼
    LDAP->>SSO: 5. ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æ¸ˆã¿
    SSO->>App: 6. èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿”ã™
    App->>User: 7. ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯
    
    Note over User,App: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ï¼
    
    User->>App: 8. åˆ¥ã®ã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ (Jellyfin)
    App->>SSO: 9. æ—¢å­˜ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯
    SSO->>App: 10. æœ‰åŠ¹ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨
    App->>User: 11. ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ä¸è¦ï¼‰
{% endmermaid %}

**èˆå°è£ã§ä½•ãŒèµ·ã“ã‚‹ã‹ï¼š**

1. **æœ€åˆã®ã‚¢ã‚¯ã‚»ã‚¹ï¼š**`nextcloud.homelab.local` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. **Traefik ãŒå‚å—ï¼š**Authelia ã«ç¢ºèª - ã€Œã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯èªè¨¼æ¸ˆã¿ã§ã™ã‹ï¼Ÿã€
3. **æœªèªè¨¼ï¼š**Authelia ãŒ `auth.homelab.local` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
4. **ãƒ­ã‚°ã‚¤ãƒ³ï¼š**ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€MFA ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›
5. **Authelia ãŒæ¤œè¨¼ï¼š**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã—ã¦èªè¨¼æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯
6. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆï¼š**Authelia ãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ Cookie ã‚’ä½œæˆ
7. **ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒãƒƒã‚¯ï¼š**Nextcloud ã«æˆ»ã•ã‚Œã‚‹
8. **ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ï¼š**Traefik ãŒæœ‰åŠ¹ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã—ã€ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯

**2ç•ªç›®ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ï¼š**

1. `grafana.homelab.local` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. Traefik ãŒ Authelia ã«ç¢ºèª - ã€Œã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯èªè¨¼æ¸ˆã¿ã§ã™ã‹ï¼Ÿã€
3. Authelia ãŒæ—¢å­˜ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ Cookie ã‚’ç¢ºèª - ã€Œã¯ã„ã€Alice ã§ã™ï¼ã€
4. ã™ãã«ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ - **ãƒ­ã‚°ã‚¤ãƒ³ä¸è¦**

ã“ã‚ŒãŒ SSO ã®é­”æ³•ã§ã™ - ä¸€åº¦ã®ãƒ­ã‚°ã‚¤ãƒ³ã§ã€ã©ã“ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ï¼


## å¤šè¦ç´ èªè¨¼ã®è¿½åŠ 

### MFA ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ¦‚è¦

| æ–¹æ³• | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | åˆ©ä¾¿æ€§ | ã‚³ã‚¹ãƒˆ | ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°è€æ€§ |
|--------|----------|-------------|------|-------------------|
| **Passkey (WebAuthn)** | æœ€é«˜ | é«˜ | ç„¡æ–™ | âœ… ã¯ã„ |
| **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚­ãƒ¼** | æœ€é«˜ | ä¸­ | $25-50 | âœ… ã¯ã„ |
| **TOTP (èªè¨¼ã‚¢ãƒ—ãƒª)** | é«˜ | ä¸­ | ç„¡æ–™ | âŒ ã„ã„ãˆ |
| **SMS** | ä½ | é«˜ | SMS ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãŒå¿…è¦ | âŒ ã„ã„ãˆ |

### 1. Passkey (WebAuthn) - æ¨å¥¨

**Passkey ã¨ã¯ï¼Ÿ**

Passkey ã¯ã€ç”Ÿä½“èªè¨¼ï¼ˆæŒ‡ç´‹ã€é¡”ã€PINï¼‰ã‚’ä½¿ç”¨ã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç¾ä»£çš„ãªä»£æ›¿å“ã§ã™ã€‚

**ç¾å®Ÿä¸–ç•Œã®ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼ï¼š**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ä»£ã‚ã‚Šã«ã€æŒ‡ç´‹ã§ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã™ã‚‹ã‚ˆã†ãªã‚‚ã®ã€‚

**ä»•çµ„ã¿ï¼š**
- ãƒ‡ãƒã‚¤ã‚¹ãŒæš—å·åŒ–ã‚­ãƒ¼ã‚’ä¿å­˜
- ç”Ÿä½“èªè¨¼ï¼ˆæŒ‡ç´‹/é¡”ï¼‰ã¾ãŸã¯ãƒ‡ãƒã‚¤ã‚¹ PIN ã§èªè¨¼
- ç›—ã¾ã‚ŒãŸã‚Šãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ã•ã‚ŒãŸã‚Šã™ã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãªã„
- ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸã§ãƒ‡ãƒã‚¤ã‚¹é–“ã§å‹•ä½œï¼ˆiCloud ã‚­ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã€Google ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼‰

**Authentik ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼š**

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ è¨­å®š
2. MFA ãƒ‡ãƒã‚¤ã‚¹ â†’ ç™»éŒ²
3. **WebAuthn** ã¾ãŸã¯ **Passkey** ã‚’é¸æŠ
4. ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å¾“ã†ï¼š
   - **ãƒ¢ãƒã‚¤ãƒ«ï¼š**æŒ‡ç´‹/Face ID ã‚’ä½¿ç”¨
   - **ãƒ©ãƒƒãƒ—ãƒˆãƒƒãƒ—ï¼š**Touch ID/Windows Hello ã‚’ä½¿ç”¨
   - **ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼š**ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’ Passkey ã¨ã—ã¦ä½¿ç”¨ã€ã¾ãŸã¯ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚­ãƒ¼

**Authelia ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼š**

1. ä¿è­·ã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ã€Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚­ãƒ¼ã‚’ç™»éŒ²ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. Passkey ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠ
4. ç”Ÿä½“èªè¨¼ã§èªè¨¼

**ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼š**
- âœ… iPhone/iPad (iOS 16+) - Face ID/Touch ID
- âœ… Android (9+) - æŒ‡ç´‹/é¡”èªè¨¼
- âœ… macOS (Ventura+) - Touch ID
- âœ… Windows (10+) - Windows Hello
- âœ… Chrome/Edge/Safari - çµ„ã¿è¾¼ã¿ã‚µãƒãƒ¼ãƒˆ

### 2. ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚­ãƒ¼

**èªè¨¼ç”¨ã®ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ï¼š**

**Authentikï¼š**

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ è¨­å®š
2. MFA ãƒ‡ãƒã‚¤ã‚¹ â†’ ç™»éŒ²
3. WebAuthn ã‚’é¸æŠ
4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚­ãƒ¼ï¼ˆYubiKey ãªã©ï¼‰ã‚’æŒ¿å…¥
5. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã‚­ãƒ¼ã«ã‚¿ãƒƒãƒ

**äººæ°—ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚­ãƒ¼ï¼š**
- **YubiKey 5** ($45-50) - USB-A/Cã€NFC
- **YubiKey 5C Nano** ($55) - USB-C ãƒãƒ¼ãƒˆã«å¸¸é§
- **Google Titan** ($30) - USB-A/Cã€Bluetooth
- **Feitian** ($20-30) - äºˆç®—ã‚ªãƒ—ã‚·ãƒ§ãƒ³

### 3. TOTPï¼ˆèªè¨¼ã‚¢ãƒ—ãƒªï¼‰

**ã‚¢ãƒ—ãƒªã‹ã‚‰ã®æ™‚é–“ãƒ™ãƒ¼ã‚¹ã®ã‚³ãƒ¼ãƒ‰ï¼š**

**Autheliaï¼ˆçµ„ã¿è¾¼ã¿ï¼‰ï¼š**

1. ä¿è­·ã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ã€Œãƒ‡ãƒã‚¤ã‚¹ã‚’ç™»éŒ²ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. èªè¨¼ã‚¢ãƒ—ãƒªã§ QR ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³
4. 6æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ç¢ºèª

**Authentikï¼š**

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ è¨­å®š
2. MFA ãƒ‡ãƒã‚¤ã‚¹ â†’ ç™»éŒ²
3. TOTP ã‚’é¸æŠ
4. QR ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³

**æ¨å¥¨ã•ã‚Œã‚‹èªè¨¼ã‚¢ãƒ—ãƒªï¼š**
- **Aegis** (Android) - ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã€æš—å·åŒ–ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- **Raivo OTP** (iOS) - ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã€iCloud åŒæœŸ
- **2FAS** (iOS/Android) - ç„¡æ–™ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- **Authy** (iOS/Android) - ãƒãƒ«ãƒãƒ‡ãƒã‚¤ã‚¹åŒæœŸ
- **Google Authenticator** (iOS/Android) - ã‚·ãƒ³ãƒ—ãƒ«ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

!!!tip "ğŸ’¡ MFA ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹"
    **å„ªå…ˆé †ä½ï¼š**
    1. **Passkey** - æœ€ã‚‚å®‰å…¨ã§ä¾¿åˆ©ï¼ˆç”Ÿä½“èªè¨¼ã‚’ä½¿ç”¨ï¼‰
    2. **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚­ãƒ¼** - éå¸¸ã«å®‰å…¨ã€ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ãŒå¿…è¦
    3. **TOTP ã‚¢ãƒ—ãƒª** - å®‰å…¨ã ãŒã€ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ã•ã‚Œã‚‹å¯èƒ½æ€§ã‚ã‚Š
    4. **SMS ã‚’é¿ã‘ã‚‹** - SIM ã‚¹ãƒ¯ãƒƒãƒ”ãƒ³ã‚°ã«è„†å¼±
    
    **æ¨å¥¨äº‹é …ï¼š**
    - **ç®¡ç†è€…ã«ã¯ MFA ã‚’å¿…é ˆã«**ï¼ˆPasskey ã¾ãŸã¯ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚­ãƒ¼ã‚’ä½¿ç”¨ï¼‰
    - **å®¶æ—ã«ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³**ï¼ˆæ‘©æ“¦ã‚’æ¸›ã‚‰ã™ã€Passkey ã¯ç°¡å˜ï¼‰
    - **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚³ãƒ¼ãƒ‰** - ç”Ÿæˆã—ã¦å®‰å…¨ã«ä¿å­˜
    - **è¤‡æ•°ã®æ–¹æ³•** - Passkey + TOTP ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã—ã¦ç™»éŒ²
    - **Passkey åŒæœŸ** - iCloud/Google ã‚’ä½¿ç”¨ã—ã¦ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹

## SSO æœ‰åŠ¹åŒ–å¾Œã‚‚ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä¿æŒã™ã¹ãã‹ï¼Ÿ

**çŸ­ã„ç­”ãˆï¼šã¯ã„ã€å¸¸ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä¿æŒã—ã¦ãã ã•ã„ã€‚**

### ãªãœãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä¿æŒã™ã‚‹ã®ã‹ï¼Ÿ

**SSO ã¯å˜ä¸€éšœå®³ç‚¹ã§ã™ã€‚**SSO ã‚·ã‚¹ãƒ†ãƒ ãŒãƒ€ã‚¦ãƒ³ã™ã‚‹ã¨ã€ã™ã¹ã¦ã‹ã‚‰ãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã•ã‚Œã¾ã™ã€‚

**SSO ãŒå¤±æ•—ã™ã‚‹å®Ÿä¸–ç•Œã®ã‚·ãƒŠãƒªã‚ªï¼š**

1. **SSO ã‚³ãƒ³ãƒ†ãƒŠãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥** - Docker/Kubernetes ã®å•é¡Œ
2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç ´æ** - Authelia/Authentik ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å•é¡Œ
3. **è¨­å®šã‚¨ãƒ©ãƒ¼** - è¨­å®šã®ã‚¿ã‚¤ãƒ—ãƒŸã‚¹ãŒèªè¨¼ã‚’å£Šã™
4. **è¨¼æ˜æ›¸ã®æœŸé™åˆ‡ã‚Œ** - HTTPS è¨¼æ˜æ›¸ãŒæœŸé™åˆ‡ã‚Œã€SSO ã«åˆ°é”ä¸å¯
5. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å•é¡Œ** - DNS ã®å•é¡Œã€ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ãŒãƒ€ã‚¦ãƒ³
6. **èª¤å‰Šé™¤** - é–“é•ã£ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤

**ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãªã—ã®å ´åˆï¼š**
```
SSO ãƒ€ã‚¦ãƒ³ â†’ ä½•ã«ã‚‚ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„ â†’ SSO ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ä¿®æ­£ã§ããªã„ â†’ ãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
```

**ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ã‚‹å ´åˆï¼š**
```
SSO ãƒ€ã‚¦ãƒ³ â†’ ãƒ­ãƒ¼ã‚«ãƒ«ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ â†’ SSO ã‚’ä¿®æ­£ â†’ é€šå¸¸ã«æˆ»ã‚‹
```

### ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

!!!danger "ğŸ”’ é‡è¦ï¼šãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä¿è­·ã™ã‚‹"
    ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ SSO ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã€ä¿è­·ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
    - **å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰** - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ä½¿ç”¨ã€20æ–‡å­—ä»¥ä¸Š
    - **ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ MFA ã‚’æœ‰åŠ¹åŒ–** - å¤šãã®ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚µãƒãƒ¼ãƒˆ
    - **ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’åˆ¶é™** - ç®¡ç†è€…/ç·Šæ€¥ã‚¢ã‚¯ã‚»ã‚¹ç”¨ã®ã¿ä½œæˆ
    - **ç•°ãªã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰** - SSO ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†åˆ©ç”¨ã—ãªã„
    - **èªè¨¼æƒ…å ±ã‚’æ–‡æ›¸åŒ–** - å®‰å…¨ã«ä¿å­˜ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã€æš—å·åŒ–ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

!!!tip "ğŸ’¡ ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ«ãƒ¼ãƒ«"
    **å¸¸ã«å®‰å…¨ãªãƒãƒƒã‚¯ãƒ‰ã‚¢ã‚’ç¶­æŒï¼š**
    - SSO ã¯æ­£é¢ç„é–¢ï¼ˆä¾¿åˆ©ã€å®‰å…¨ï¼‰
    - ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯éå¸¸å£ï¼ˆã‚ã£ãŸã«ä½¿ã‚ãªã„ãŒã€å¸¸ã«åˆ©ç”¨å¯èƒ½ï¼‰
    - ä¸¡æ–¹ã¨ã‚‚ MFA ã§ä¿è­·ã™ã¹ã
    - ä¸¡æ–¹ã‚’å®šæœŸçš„ã«ãƒ†ã‚¹ãƒˆ
    
    å®¶ã®å¤–ã«éš ã—ã¦ãŠã„ãŸäºˆå‚™ã®éµã®ã‚ˆã†ãªã‚‚ã®ã¨è€ƒãˆã¦ãã ã•ã„ - ã‚ã£ãŸã«å¿…è¦ã‚ã‚Šã¾ã›ã‚“ãŒã€å¿…è¦ãªã¨ãã«ãã“ã«ã‚ã‚‹ã“ã¨ã‚’å–œã¶ã§ã—ã‚‡ã†ï¼

## çµè«–

ãƒ›ãƒ¼ãƒ ã§ SSO ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã¨ã€ãƒ›ãƒ¼ãƒ ãƒ©ãƒœãŒå€‹åˆ¥ã®ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰çµ±ä¸€ã•ã‚ŒãŸãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«å¤‰ã‚ã‚Šã¾ã™ã€‚åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æŠ•è³‡ã¯ã€åˆ©ä¾¿æ€§ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å‘ä¸Šã§ã™ãã«å ±ã‚ã‚Œã¾ã™ã€‚

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š**

- SSO ã¯è¤‡æ•°ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ãŸã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç–²åŠ´ã‚’è§£æ¶ˆ
- **Authelia ã¯ã‚·ãƒ³ãƒ—ãƒ«ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«æœ€é©** ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã¨å…±ã«
- **Authentik ã¯å®Œå…¨ãªæ©Ÿèƒ½ã‚’æä¾›** ç¾ã—ã„ UI ã¨å…±ã«
- ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã¯ä»»æ„ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä¿è­·
- MFA ã¯é‡è¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
- LDAP çµ±åˆã¯å¤§è¦æ¨¡ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã«å¯¾å¿œ
- å®šæœŸçš„ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒä¸å¯æ¬ ï¼ˆSSO ã¯å˜ä¸€éšœå®³ç‚¹ï¼‰
- **ãƒ›ãƒ¼ãƒ ãƒ©ãƒœ SSO ã¯ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã«åˆ¶é™ã•ã‚Œã‚‹** - SaaS çµ±åˆã«ã¯é«˜ä¾¡ãªã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ—ãƒ©ãƒ³ãŒå¿…è¦
- ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆOIDC/SAMLï¼‰ã¯ã‚·ã‚¹ãƒ†ãƒ é–“ã§ SSO ã‚’å¯èƒ½ã«ã™ã‚‹ãŒã€WIA ã¯éãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

**ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆæ¨å¥¨ï¼š**

ã»ã¨ã‚“ã©ã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒœã®å ´åˆï¼š
1. **Authelia** + Traefik ã‹ã‚‰å§‹ã‚ã‚‹ï¼ˆæœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªé“ï¼‰
2. æœ€åˆã¯ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹èªè¨¼ã‚’ä½¿ç”¨
3. ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã« MFA ã‚’è¿½åŠ 
4. å¾ã€…ã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’ SSO ã«ç§»è¡Œ
5. å¾Œã§ OIDC/SAML ãŒå¿…è¦ãªå ´åˆã¯ Authentik ã‚’æ¤œè¨

2-3 ã®ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰å§‹ã‚ã¦ã€ãƒ•ãƒ­ãƒ¼ã«æ…£ã‚Œã¦ã‹ã‚‰æ‹¡å¼µã—ã¦ãã ã•ã„ã€‚ã‚‚ã†ä½•åã‚‚ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚„ã‚Šãã‚Šã—ãªãã¦æ¸ˆã‚€ã‚ˆã†ã«ãªã£ãŸã¨ãã€æœªæ¥ã®è‡ªåˆ†ãŒæ„Ÿè¬ã™ã‚‹ã§ã—ã‚‡ã†ï¼ğŸ”


## Authentik ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ã‚¹ãƒ†ãƒƒãƒ— 1ï¼šDocker Compose ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# å…¬å¼ compose ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
wget https://goauthentik.io/docker-compose.yml
wget https://goauthentik.io/.env

# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç”Ÿæˆ
echo "PG_PASS=$(openssl rand -base64 36)" >> .env
echo "AUTHENTIK_SECRET_KEY=$(openssl rand -base64 60)" >> .env

# ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•
docker-compose up -d
```

### ã‚¹ãƒ†ãƒƒãƒ— 2ï¼šåˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. `http://localhost:9000/if/flow/initial-setup/` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ
3. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã‚’å®Œäº†

### ã‚¹ãƒ†ãƒƒãƒ— 3ï¼šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ

1. **Applications â†’ Create**
   - Name: Nextcloud
   - Slug: nextcloud
   - Provider: æ–°ã—ã„ OIDC ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ä½œæˆ

2. **OIDC ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®è¨­å®š**
   - Client Type: Confidential
   - Redirect URIs: `https://nextcloud.homelab.local/apps/oidc_login/oidc`
   - Signing Key: è‡ªå‹•ç”Ÿæˆ

3. **èªè¨¼æƒ…å ±ã‚’ãƒ¡ãƒ¢ï¼š**
   - Client ID: (è‡ªå‹•ç”Ÿæˆ)
   - Client Secret: (è‡ªå‹•ç”Ÿæˆ)

### ã‚¹ãƒ†ãƒƒãƒ— 4ï¼šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®šï¼ˆNextcloud ã®ä¾‹ï¼‰

```php
// nextcloud/config/config.php
'oidc_login_provider_url' => 'https://auth.homelab.local/application/o/nextcloud/',
'oidc_login_client_id' => 'your-client-id',
'oidc_login_client_secret' => 'your-client-secret',
'oidc_login_auto_redirect' => true,
'oidc_login_button_text' => 'Log in with SSO',
'oidc_login_hide_password_form' => true,
'oidc_login_attributes' => [
    'id' => 'sub',
    'name' => 'name',
    'mail' => 'email',
    'groups' => 'groups',
],
```

## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çµ±åˆ

### ãƒã‚¤ãƒ†ã‚£ãƒ– OIDC ã‚µãƒãƒ¼ãƒˆã‚’æŒã¤ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

**Grafanaï¼š**

```ini
# grafana.ini
[auth.generic_oauth]
enabled = true
name = SSO
client_id = grafana-client-id
client_secret = grafana-client-secret
scopes = openid profile email
auth_url = https://auth.homelab.local/application/o/authorize/
token_url = https://auth.homelab.local/application/o/token/
api_url = https://auth.homelab.local/application/o/userinfo/
```

**Portainerï¼š**

1. Settings â†’ Authentication
2. OAuth â†’ Enable
3. Authentik ã‹ã‚‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®š

**Home Assistantï¼š**

```yaml
# configuration.yaml
auth_providers:
  - type: homeassistant
  - type: command_line
    command: /config/auth_script.sh
    args: ["--username"]
    meta: true
```

### OIDC ã‚µãƒãƒ¼ãƒˆã®ãªã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

Authelia/Traefik ã§**ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰èªè¨¼**ã‚’ä½¿ç”¨ï¼š

```yaml
# ä»»æ„ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä¿è­·
labels:
  - "traefik.http.routers.myapp.middlewares=authelia@docker"
```

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒãƒ¼ãƒˆãƒãƒˆãƒªãƒƒã‚¯ã‚¹

| ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ | OIDC | SAML | ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰èªè¨¼ | é›£æ˜“åº¦ |
|-------------|------|------|--------------|------------|
| **Nextcloud** | âœ… ã¯ã„ | âœ… ã¯ã„ | âœ… ã¯ã„ | ç°¡å˜ |
| **Grafana** | âœ… ã¯ã„ | âŒ ã„ã„ãˆ | âœ… ã¯ã„ | ç°¡å˜ |
| **Portainer** | âœ… ã¯ã„ | âŒ ã„ã„ãˆ | âœ… ã¯ã„ | ç°¡å˜ |
| **Jellyfin** | âš ï¸ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ | âŒ ã„ã„ãˆ | âœ… ã¯ã„ | ä¸­ |
| **Home Assistant** | âš ï¸ ã‚«ã‚¹ã‚¿ãƒ  | âŒ ã„ã„ãˆ | âœ… ã¯ã„ | ä¸­ |
| **Proxmox** | âœ… ã¯ã„ | âŒ ã„ã„ãˆ | âŒ ã„ã„ãˆ | ä¸­ |
| **TrueNAS** | âŒ ã„ã„ãˆ | âœ… ã¯ã„ | âœ… ã¯ã„ | é›£ |

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¿½åŠ ï¼ˆAutheliaï¼‰

```yaml
# config/users_database.yml
users:
  newuser:
    displayname: "New User"
    password: "$argon2id$v=19$m=65536,t=3,p=4$..."
    email: newuser@homelab.local
    groups:
      - users
```

å¤‰æ›´å¾Œã« Authelia ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¿½åŠ ï¼ˆAuthentikï¼‰

1. **Directory â†’ Users â†’ Create**
2. è©³ç´°ã‚’å…¥åŠ›
3. ã‚°ãƒ«ãƒ¼ãƒ—ã«å‰²ã‚Šå½“ã¦
4. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šï¼ˆã¾ãŸã¯æ‹›å¾…ã‚’é€ä¿¡ï¼‰

### ã‚°ãƒ«ãƒ¼ãƒ—ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

**Autheliaï¼š**

```yaml
# config/configuration.yml
access_control:
  rules:
    - domain: "admin.homelab.local"
      policy: two_factor
      subject:
        - "group:admins"
    
    - domain: "*.homelab.local"
      policy: two_factor
      subject:
        - "group:users"
```

**Authentikï¼š**

1. ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆï¼šadminsã€usersã€family
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚°ãƒ«ãƒ¼ãƒ—ã«å‰²ã‚Šå½“ã¦
3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼ã§ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ã‚’ãƒã‚§ãƒƒã‚¯

## é«˜åº¦ï¼šLDAP çµ±åˆ

å¤§è¦æ¨¡ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®å ´åˆã€LDAP ã‚’ä¸­å¤®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚

### OpenLDAP ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```yaml
# docker-compose.yml
services:
  openldap:
    image: osixia/openldap:latest
    environment:
      - LDAP_ORGANISATION=Homelab
      - LDAP_DOMAIN=homelab.local
      - LDAP_ADMIN_PASSWORD=admin_password
    volumes:
      - ldap_data:/var/lib/ldap
      - ldap_config:/etc/ldap/slapd.d
    ports:
      - "389:389"
      - "636:636"

  ldap-admin:
    image: osixia/phpldapadmin:latest
    environment:
      - PHPLDAPADMIN_LDAP_HOSTS=openldap
    ports:
      - "8080:80"
    depends_on:
      - openldap

volumes:
  ldap_data:
  ldap_config:
```

### Authelia ã‚’ LDAP ã§è¨­å®š

```yaml
# config/configuration.yml
authentication_backend:
  ldap:
    url: ldap://openldap:389
    base_dn: dc=homelab,dc=local
    username_attribute: uid
    additional_users_dn: ou=users
    users_filter: (&({username_attribute}={input})(objectClass=person))
    additional_groups_dn: ou=groups
    groups_filter: (&(member={dn})(objectClass=groupOfNames))
    user: cn=admin,dc=homelab,dc=local
    password: admin_password
```

### Authentik ã‚’ LDAP ã§è¨­å®š

1. **Directory â†’ Federation & Social â†’ LDAP Sources**
2. æ–°ã—ã„ LDAP ã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ
3. æ¥ç¶šã®è©³ç´°ã‚’è¨­å®š
4. å±æ€§ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

!!!danger "âš ï¸ é‡è¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–"
    **SSO ã‚·ã‚¹ãƒ†ãƒ ã‚’ä¿è­·ï¼š**
    - SSO ã¯å˜ä¸€éšœå®³ç‚¹ - ã—ã£ã‹ã‚Šä¿è­·ã™ã‚‹
    - å¼·åŠ›ãªç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
    - ã™ã¹ã¦ã®ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ MFA ã‚’æœ‰åŠ¹åŒ–
    - ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’æœ€æ–°ã«ä¿ã¤
    - èªè¨¼ãƒ­ã‚°ã‚’ç›£è¦–
    - è¨­å®šã‚’å®šæœŸçš„ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼š**

- [ ] ã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
- [ ] ç®¡ç†è€…ã« MFA ã‚’æœ‰åŠ¹åŒ–
- [ ] ã™ã¹ã¦ã®å ´æ‰€ã§ HTTPSï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ CA ã‚’ä½¿ç”¨ï¼‰
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’æœ‰åŠ¹åŒ–
- [ ] ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—ã®é€šçŸ¥
- [ ] å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
- [ ] èªè¨¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- [ ] å¾©æ—§æ‰‹é †ã‚’æ–‡æ›¸åŒ–
- [ ] ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¾©æ—§ãƒ•ãƒ­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ
- [ ] ä¸å¯©ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’ç›£è¦–

**ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼š**

```yaml
# Authelia ãƒ¬ãƒ¼ãƒˆåˆ¶é™
regulation:
  max_retries: 3
  find_time: 2m
  ban_time: 5m
```

**ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼š**

```yaml
# çŸ­ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
session:
  expiration: 1h
  inactivity: 15m
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œï¼šãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ«ãƒ¼ãƒ—

**åŸå› ï¼š**ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã¾ãŸã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ Cookie ã®è¨­å®šãƒŸã‚¹

**è§£æ±ºç­–ï¼š**
```yaml
# ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
session:
  domain: homelab.local  # ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ä¸€è‡´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
```

### å•é¡Œï¼šã€ŒInvalid Redirect URIã€

**åŸå› ï¼š**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ãŒ OIDC è¨­å®šã¨ä¸€è‡´ã—ãªã„

**è§£æ±ºç­–ï¼š**
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã§å®Ÿéš›ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ã‚’ç¢ºèªã—ã€IdP ã§æ›´æ–°ã—ã¾ã™ã€‚

### å•é¡Œï¼šãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„

**åŸå› ï¼š**èªå¯ãƒ˜ãƒƒãƒ€ãƒ¼ãŒæ¬ è½

**è§£æ±ºç­–ï¼š**
```yaml
# Traefik - ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè»¢é€ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- "traefik.http.middlewares.authelia.forwardauth.authResponseHeaders=Remote-User,Remote-Groups"
```

### å•é¡Œï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒæ—©ã™ãã‚‹

**è§£æ±ºç­–ï¼š**
```yaml
# ã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé–“ã‚’å»¶é•·
session:
  expiration: 12h
  inactivity: 2h
  remember_me_duration: 1M
```

## ç›£è¦–ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### ãƒ­ã‚°ç›£è¦–

```bash
# Authelia ãƒ­ã‚°
docker logs -f authelia

# ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—ã‚’ç›£è¦–
docker logs authelia 2>&1 | grep "authentication failed"
```

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥

```bash
#!/bin/bash
# backup-sso.sh

BACKUP_DIR="/backups/sso/$(date +%Y%m%d)"
mkdir -p $BACKUP_DIR

# Authelia ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp -r /path/to/authelia/config $BACKUP_DIR/
cp -r /path/to/authelia/secrets $BACKUP_DIR/

# Authentik ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
docker exec authentik-postgres pg_dump -U authentik > $BACKUP_DIR/authentik.sql

echo "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: $BACKUP_DIR"
```

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```yaml
# docker-compose.yml
services:
  authelia:
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:9091/api/health"]
      interval: 30s
      timeout: 3s
      retries: 3
```

## æ¯”è¼ƒï¼šSSO ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

| å´é¢ | Authelia | Authentik | Keycloak |
|--------|----------|-----------|----------|
| **RAM ä½¿ç”¨é‡** | ~50MB | ~500MB | ~1GB |
| **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚é–“** | 30åˆ† | 1æ™‚é–“ | 2æ™‚é–“ä»¥ä¸Š |
| **è¨­å®šæ–¹æ³•** | YAML | Web UI | Web UI |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸** | ãƒ•ã‚¡ã‚¤ãƒ«/LDAP | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹/LDAP |
| **OIDC** | åŸºæœ¬ | å®Œå…¨ | å®Œå…¨ |
| **SAML** | âŒ | âœ… | âœ… |
| **å­¦ç¿’æ›²ç·š** | ä½ | ä¸­ | é«˜ |
| **ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£** | æ´»ç™º | éå¸¸ã«æ´»ç™º | å·¨å¤§ |

## ãƒªã‚½ãƒ¼ã‚¹

- **[Authelia ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.authelia.com/)ï¼š**å®Œå…¨ãª Authelia ã‚¬ã‚¤ãƒ‰
- **[Authentik ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://goauthentik.io/docs/)ï¼š**Authentik ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨è¨­å®š
- **[Keycloak ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.keycloak.org/documentation)ï¼š**ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º SSO ã‚¬ã‚¤ãƒ‰
- **[OIDC èª¬æ˜](https://openid.net/connect/)ï¼š**OpenID Connect ã®ç†è§£
