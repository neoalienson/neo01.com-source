---
title: "Defang URL：分享威脅資訊的簡單安全實踐"
date: 2021-05-01
lang: zh-TW
categories: Cybersecurity
tags: [Security, Best Practices, Threat Intelligence]
excerpt: "Defang URL 可防止在分享威脅情報時意外點擊惡意連結。了解安全團隊為何使用這種做法以及如何實施。"
comments: true
thumbnail: /assets/puzzle/thumbnail.png
---

每個人都會遇到可疑連結、釣魚郵件和潛在詐騙。無論是向銀行報告詐欺、與 IT 支援分享可疑郵件，還是警告朋友注意釣魚攻擊，你都需要在不意外傳播威脅的情況下傳達這些資訊。意外點擊惡意連結可能會危及你的裝置或帳戶。

安全專業人員將這些危險的 URL、IP 位址和電子郵件地址稱為「入侵指標」（Indicators of Compromise，簡稱 IOC）——潛在安全威脅的證據。Defang 作為一種簡單而有效的解決方案應運而生，用於安全地分享 IOC。透過修改 URL 使其不可點擊但保持可讀性，任何人都可以在不產生新風險的情況下分享危險連結。這種做法已成為安全專業人員、IT 支援團隊以及越來越多保護自己和他人的普通網路使用者的標準做法。

## 問題：文件中的可點擊威脅

安全文件本質上包含危險內容。事件報告引用釣魚 URL，惡意軟體分析文件包含命令與控制伺服器位址，威脅情報來源列出被入侵的網域。當這些文件透過電子郵件、聊天或協作平台共享時，URL 通常會變成可點擊的連結。

!!!warning "⚠️ 可點擊連結的風險"
    **意外點擊**
    - 審查報告的安全分析師可能會意外點擊惡意連結
    - 電子郵件客戶端和瀏覽器會自動將 URL 呈現為可點擊
    - 行動裝置使意外點擊更容易發生
    - 複製貼上操作可能觸發 URL 預覽功能
    
    **自動化系統**
    - 安全工具可能會自動掃描或存取 URL
    - 電子郵件安全閘道可能會追蹤連結進行分析
    - 協作平台可能會產生連結預覽
    - 備份系統可能會索引和處理 URL
    
    **社交工程**
    - 攻擊者監控安全討論和報告
    - 惡意行為者可能誘騙分析師點擊看似「安全」的 IOC
    - 釣魚活動專門針對安全團隊
    - 對安全文件的信任可能被利用

諷刺的是：旨在防範威脅的文件本身可能成為威脅載體。透過電子郵件共享的惡意軟體分析報告可能會在收件人意外點擊正在分析的 URL 時觸發感染。

## 什麼是 Defang？

Defang 修改 URL、IP 位址和電子郵件地址，使其不可點擊但保持可讀性。這些修改是簡單的字元替換，可以破壞自動連結偵測而不會模糊內容。

!!!anote "🔧 常見 Defang 技術"
    **URL Defang**
    - 將 `.` 替換為 `[.]`：`example[.]com`
    - 將 `http` 替換為 `hxxp`：`hxxp://example.com`
    - 將 `://` 替換為 `[://]`：`http[://]example.com`
    - 將連接埠中的 `:` 替換為 `[:]`：`example.com[:]8080`
    
    **IP 位址 Defang**
    - 將 `.` 替換為 `[.]`：`192[.]168[.]1[.]1`
    - 替代方案：`192.168.1[.]1`（僅最後一個點）
    
    **電子郵件地址 Defang**
    - 將 `@` 替換為 `[@]`：`user[@]example.com`
    - 將 `.` 替換為 `[.]`：`user@example[.]com`
    - 組合：`user[@]example[.]com`

Defang 後的版本仍然易於閱讀。任何人都可以輕鬆理解 `hxxp://malicious[.]example[.]com` 指的是 `http://malicious.example.com`，但電子郵件客戶端和瀏覽器不會自動建立可點擊的連結。

### Refang：恢復原始格式

當這些連結需要在安全工具或指令碼中使用時，必須進行「refang」——轉換回原始格式。這通常透過程式設計方式完成：

```python
def refang_url(defanged_url):
    """將 defang 的 URL 轉換回原始格式"""
    refanged = defanged_url
    refanged = refanged.replace('[.]', '.')
    refanged = refanged.replace('hxxp', 'http')
    refanged = refanged.replace('[://]', '://')
    refanged = refanged.replace('[:]', ':')
    return refanged

# 使用範例
defanged = "hxxp://malicious[.]example[.]com[:]8080/path"
original = refang_url(defanged)
# 結果：http://malicious.example.com:8080/path
```

安全工具和威脅情報平台通常包含內建的 defang 和 refang 功能，為分析師自動化該過程。

## 產業採用和標準

Defang 已成為整個安全產業的標準做法。主要組織和平台都採用了這種技術：

!!!success "✅ 產業使用情況"
    **威脅情報平台**
    - MISP（惡意軟體資訊共享平台）支援 defang
    - ThreatConnect 在報告中自動 defang 指標
    - AlienVault OTX 在威脅來源中顯示 defang 的 URL
    - VirusTotal 評論經常使用 defang 格式
    
    **安全營運**
    - SOC 分析師在事件工單中 defang 指標
    - 威脅狩獵報告使用 defang 的指標
    - 惡意軟體分析文件 defang C2 伺服器
    - 釣魚調查 defang 惡意 URL
    
    **通訊管道**
    - 安全郵件列表要求 defang IOC
    - Slack/Teams 安全頻道使用 defang
    - Twitter 安全社群使用 defang 格式
    - 會議簡報 defang 現場展示

這種做法已經變得如此普遍，以至於安全專業人員立即識別 defang 格式。看到 `hxxp` 或 `[.]` 就表示「這是一個惡意指標」，無需明確的警告標籤。

## 何時使用 Defang

並非每個 URL 都需要 defang。在分享潛在惡意內容時，這種做法最有價值：

!!!tip "🎯 應該 Defang 的內容"
    **惡意指標**
    - 來自電子郵件活動的釣魚 URL
    - 惡意軟體下載位置
    - 命令與控制伺服器位址
    - 被入侵的網站 URL
    - 漏洞利用工具包登陸頁面
    
    **可疑內容**
    - 正在調查的 URL
    - 被安全工具標記的網域
    - 與攻擊相關的 IP 位址
    - 用於釣魚的電子郵件地址
    
    **安全文件**
    - 事件回應報告
    - 威脅情報簡報
    - 惡意軟體分析報告
    - 安全培訓教材
    - 漏洞揭露

!!!anote "ℹ️ 不應該 Defang 的內容"
    **合法資源**
    - 安全供應商網站
    - 修補程式下載位置
    - 文件參考
    - 工具下載連結
    - 教育資源
    
    **情境很重要**
    - 內部安全工具（已在受控環境中）
    - 由安全工具使用的自動化來源
    - 下一步立即需要 refang 的情況

關鍵問題是：有人可能意外點擊這個並造成傷害嗎？如果是，就 defang 它。

## 在工作流程中實施 Defang

將 defang 整合到安全工作流程中需要技術工具和流程變更：

!!!anote "🔧 實施方法"
    **手動 Defang**
    - 用於一次性分享的快速編輯
    - 在文件中手動替換字元
    - 適用於少量連結
    - 容易出現不一致和錯誤
    
    **瀏覽器擴充功能**
    - 一鍵 defang 選定的文字
    - 複製 URL 時自動 defang
    - 團隊間格式一致
    
    **命令列工具**
    - 批次處理連結清單
    - 與安全指令碼整合
    - 管線中的自動化 defang
    
    **安全平台整合**
    - 工單系統中的自動 defang
    - 威脅情報平台中的內建 defang
    - Defang 顯示，按需 refang

對於快速 defang 需求，我建立了一個簡單的基於 Web 的工具：[Defang 工具](/zh-TW/tools/defang/)。它處理 URL、IP 和電子郵件地址，具有可自訂的 defang 選項。該工具完全在瀏覽器中執行——不會將資料傳送到伺服器，因此對敏感 IOC 是安全的。

### 改善 Defang URL 的使用者體驗

雖然 defang 可以防止意外點擊，但它可能會給合法使用帶來摩擦。智慧實作在安全性和可用性之間取得平衡：

!!!tip "🎯 使用者體驗最佳實踐"
    **一鍵 Refang**
    - 在 defang 的 URL 旁邊提供「複製原始」按鈕
    - 點擊自動 refang 並複製到剪貼簿
    - 減少需要原始連結的分析師的手動編輯
    - 範例：`hxxp://example[.]com` → 點擊 → 複製 `http://example.com`
    
    **視覺指示器**
    - 對 defang 的內容使用獨特的樣式（等寬字型、不同顏色）
    - 新增圖示或徽章指示「defang」狀態
    - 明確表明 URL 已被有意修改
    - 防止對「損壞」連結的混淆
    
    **懸停工具提示**
    - 懸停時顯示原始 URL 而不使其可點擊
    - 顯示「點擊複製原始」說明
    - 提供情境而無需文件
    
    **選擇性 Defang**
    - 允許使用者在 defang 和原始檢視之間切換
    - 在受控環境中有用（SOC 工作站）
    - 需要身分驗證或明確的使用者操作
    - 在保持安全性的同時提供彈性
    
    **情境感知顯示**
    - 在電子郵件和公共頻道中預設 defang
    - 在沙箱分析環境中顯示原始
    - 根據使用者角色和環境安全性進行調整
    
    **掃描後 Defang**
    - 將 URL 提交到掃描服務（VirusTotal、URLScan.io）
    - 掃描完成後自動 defang
    - 在 defang 的 URL 中包含掃描結果連結
    - 在分享前提供安全驗證
    - 範例：「hxxp://example[.]com（VirusTotal：5/89 偵測）」

[Defang 工具](/zh-TW/tools/defang/)實作了其中幾種模式：可自訂的 defang 選項讓你選擇要套用的轉換，一鍵複製按鈕使輸出易於使用。該工具會記住你的偏好，簡化重複的 defang 任務。

### 團隊流程考量

除了工具之外，成功的 defang 還需要團隊協調：

!!!success "✅ 流程最佳實踐"
    **建立標準**
    - 記錄要使用的 defang 格式
    - 指定何時需要 defang
    - 為常見場景建立範本
    - 培訓團隊成員該做法
    
    **整合到工作流程**
    - 將 defang 步驟新增到事件回應程序
    - 在報告範本中包含 defang
    - 設定工單系統以提示 defang
    - 審查共享內容以確保正確 defang
    
    **平衡安全性和可用性**
    - 不要 defang 內部工具 URL
    - 為需要的分析師提供簡單的 refang
    - 在決定 defang 時考慮情境
    - 避免過度 defang 合法內容

目標是使 defang 自動化且輕鬆，而不是給安全營運增加摩擦。

## 局限性和注意事項

Defang 不是完整的安全解決方案。它可以防止意外點擊，但有局限性：

!!!warning "⚠️ Defang 無法防止的內容"
    **有意行為**
    - 分析師可以手動 refang 並存取 URL
    - Defang 不能防止有意存取
    - 不能替代適當的安全控制
    
    **複雜攻擊**
    - 攻擊者可以在釣魚中包含 defang 的 URL
    - 社交工程可以誘騙使用者 refang
    - Defang 不驗證 URL 安全性
    
    **工具相容性**
    - 某些安全工具需要標準 URL 格式
    - 自動化處理可能需要 refang
    - 與外部系統的整合可能會中斷

Defang 是縱深防禦中的一層。它應該補充而不是替代其他安全措施，如沙箱分析環境、網路分段和安全意識培訓。

### 人為因素

Defang 的有效性取決於人類行為：

!!!tip "🎯 人為考量"
    **需要培訓**
    - 新團隊成員必須學習該做法
    - 解釋為什麼 defang 很重要
    - 示範正確的 defang 技術
    - 展示必要時如何 refang
    
    **一致性很重要**
    - 不一致的 defang 會造成混淆
    - 混合格式降低有效性
    - 全團隊採用至關重要
    
    **不要製造虛假安全感**
    - Defang 不會使 URL 安全存取
    - 分析師仍然需要適當的安全控制
    - 分析仍需要沙箱環境
    - Defang 是便利，不是保護

當整個安全團隊理解並一致套用時，該做法效果最佳。

## 超越 URL：其他 Defang 應用

雖然 URL 是最常見的用例，但 defang 適用於其他指標：

!!!anote "📋 其他可 Defang 的內容"
    **檔案路徑**
    - 惡意軟體位置：`C[:]\\Windows\\System32\\malware.exe`
    - 網路共享：`\\\\server[.]domain[.]com\\share`
    
    **登錄機碼**
    - `HKEY_LOCAL_MACHINE\\Software\\Malware`（已經不可點擊）
    - 用於文件中的一致性
    
    **命令字串**
    - 帶有 URL 的 PowerShell 命令
    - 帶有惡意端點的 Curl/wget 命令
    - 包含 IOC 的指令碼
    
    **加密貨幣地址**
    - 勒索軟體中使用的比特幣地址
    - 詐騙中的以太坊地址
    - 防止意外複製到剪貼簿

原則保持不變：使潛在危險的內容不可互動，同時保持可讀性。

## 結論

Defang URL 代表了一種簡單而有效的安全實踐，已成為威脅情報和事件回應的標準。透過修改 URL、IP 位址和電子郵件地址以防止自動連結建立，安全團隊可以安全地分享入侵指標而不會產生新風險。

這種做法源於真實需求：安全文件包含必須清晰但安全地傳達的危險內容。事件報告中惡意連結的意外點擊、威脅來源中追蹤 URL 的自動化系統以及針對安全團隊的社交工程攻擊都說明了為什麼 defang 很重要。

實施很簡單。常見技術包括將點替換為 `[.]`，將 `http` 更改為 `hxxp`，以及用括號括起協定分隔符。這些修改破壞了自動連結偵測，同時保持了人類可讀性。當 IOC 需要在安全工具中使用時，它們可以輕鬆地 refang——轉換回原始格式。

產業採用廣泛。威脅情報平台、安全營運中心和安全通訊管道通常使用 defang 格式。這種做法已經變得如此普遍，以至於安全專業人員立即將 `hxxp://malicious[.]example[.]com` 識別為 defang 的惡意指標。

然而，defang 有局限性。它可以防止意外點擊，但不能阻止有意行為，不驗證 URL 安全性，並且可能需要 refang 以實現工具相容性。該做法應該補充而不是替代其他安全措施，如沙箱分析環境和安全意識培訓。

成功的 defang 需要技術工具和流程變更。無論使用手動編輯、瀏覽器擴充功能、命令列工具還是整合的安全平台，關鍵是使 defang 自動化且輕鬆。全團隊採用、一致的格式和明確的標準確保該做法提供最大收益。

對於快速 defang 需求，請嘗試 [Defang 工具](/zh-TW/tools/defang/)——一個基於瀏覽器的實用程式，可處理 URL、IP 和電子郵件地址，具有可自訂的選項。它完全在客戶端工作，因此對敏感指標是安全的。

Defang 不會防止所有安全事件，但它消除了一個常見且容易預防的風險：意外點擊安全文件中的惡意連結。在我們不斷處理危險內容的產業中，這種簡單的做法提供了寶貴的安全邊際。在分享威脅情報、記錄事件或討論惡意指標時，花點時間 defang。你的同事和你的安全態勢都會受益。
