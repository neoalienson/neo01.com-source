---
title: 3D四目並べプロンプト
layout: tools
lang: ja
---

# 3D四目並べ：技術的アプローチとゲームロジック

このドキュメントは、JavaScriptとThree.jsを使用したレンダリングによる純粋なWebのみの実装に焦点を当てた、Webブラウザ用の3D四目並べゲームを構築するための概念的アプローチを概説しています。

## パート1：技術的アプローチ（Three.jsを使用したWebのみ）

このゲームは、HTML、CSS、JavaScriptで構築されたシングルページWebアプリケーションです。Three.jsはすべての3Dレンダリングに使用されます。

**提案されたアーキテクチャ：**

1.  **HTML構造（`index.html`）：**
    *   Three.jsレンダリング用のcanvas要素を含みます。
    *   ゲームステータスとコントロール用の基本的なUI要素（リセットボタンなど）を含みます。

2.  **スタイリング（`style.css`）：**
    *   HTML要素とcanvasの基本的なスタイリングを提供します。

3.  **ゲームロジックと3Dレンダリング（`script.js`）：**
    *   この単一のJavaScriptファイルは、コアゲームロジックとThree.jsレンダリングの両方をカプセル化します。
    *   **Three.jsセットアップ：** 3Dシーン、カメラ、WebGLレンダラーを初期化します。
    *   **3Dボードとピース：** Three.jsジオメトリ（ボードの穴用のシリンダー、ピース用の球体など）を使用して5x5x5グリッドを視覚的に作成します。
    *   **ユーザーインタラクション：** マウスイベントリスナーとThree.jsレイキャスティングを実装して、3Dボード上のユーザークリックを検出し、画面座標を3Dグリッド位置に変換します。
    *   **ゲーム状態の視覚化：** 現在のゲーム状態を反映するように3Dシーンを更新します（新しいピースの追加、ボードのクリアなど）。

**ワークフローの例：**

1.  **Webページの読み込み：** `index.html`が読み込まれ、`style.css`がスタイリングを適用し、`script.js`が実行されます。
2.  **Three.jsシーンの初期化：** `script.js`がThree.jsシーンをセットアップし、空の3Dグリッドをレンダリングし、イベントリスナーを設定します。
3.  **ユーザーが3Dボードをクリック：** マウスクリックイベントが検出されます。
4.  **レイキャスティング：** Three.jsがクリック位置から3Dシーンへのレイキャストを実行し、どのグリッドセル（x、z）がターゲットにされたかを判断します。
5.  **ゲームロジック処理：** JavaScriptゲームロジックが（x、z）座標を受け取り、ピースの`y`（垂直）位置を決定し、内部ボード状態を更新し、勝利/引き分け条件をチェックします。
6.  **3Dシーンの更新：** JavaScriptコードがThree.jsに、計算された（x、y、z）座標に現在のプレイヤーの色で新しい3Dピースを追加するよう指示します。
7.  **ゲームステータスの更新：** HTML UIが現在のゲームステータスを反映するように更新されます（次のプレイヤーのターン、勝利/引き分けメッセージなど）。

## パート2：コアゲームロジック（JavaScript）

3D四目並べのコアゲームロジックはJavaScriptで実装されます。このロジックは、ゲーム状態、プレイヤーのターン、ピース配置ルール、勝利/引き分け条件を管理します。

以下は、コアゲームロジックの現在の実装を概説しています：

### 1. ゲームボードの表現

3Dゲームボードは、整数の3次元配列として表現されます：

```javascript
let board; // new Array(5).fill(0).map(() => new Array(5).fill(0).map(() => new Array(5).fill(0)))として初期化されます
```

*   `board[x][y][z]`は5x5x5キューブ内のセルを表します。
*   `x`、`y`、`z`は0から4の範囲です。
*   `0`：空のセルを表します。
*   `1`：プレイヤー1（例：赤）が配置したピースを表します。
*   `2`：プレイヤー2（例：黄）が配置したピースを表します。

### 2. ゲーム状態管理

ゲーム状態はいくつかの変数によって管理されます：

*   `let currentPlayer = 1;`：誰のターンか（1または2）を追跡します。
*   `let gameOver = false;`：ゲームが終了したか（勝利または引き分け）を示します。
*   `let gameStatus = "Player 1's Turn";`：現在のゲームステータスを表示する文字列（「プレイヤー1のターン」、「プレイヤー2の勝利！」、「引き分け！」など）。

### 3. ゲームの初期化（`initializeGame()`）

このメソッドは新しいゲームをセットアップします：

*   `board`をすべてゼロ（空）にリセットします。
*   `currentPlayer`を1に戻します。
*   `gameOver`を`false`に設定します。
*   `gameStatus`を「プレイヤー1のターン」に更新します。
*   既存のすべてのピースの3Dシーンをクリアします。

### 4. ピース配置ロジック（`addPiece(x, z)`）

このメソッドはゲームにピースを配置することを処理します：

*   **入力：** ユーザー入力から`x`（列）と`z`（深さ）座標を取ります。
*   **ゲームオーバーチェック：** `gameOver`がtrueの場合、メソッドは即座に戻ります。
*   **最も低い利用可能な`y`を見つける：** 下から（`y=0`）上に向かって反復し、選択された列（`x`、`z`）で最初の空のセル（`board[x][i][z] == 0`）を見つけます。これは重力をシミュレートします。
*   **ピースを配置：** 空の`y`位置が見つかった場合：
    *   `board`は`board[x][y][z]`で`currentPlayer`の値で更新されます。
    *   計算された`(x, y, z)`座標に現在のプレイヤーの色で新しい3DピースがThree.jsシーンに追加されます。
*   **勝利/引き分け条件のチェック：** ピースを配置した後、`checkWin()`と`checkDraw()`を呼び出して次のゲーム状態を決定します。
*   **ゲームステータスの更新：** 結果（勝利、引き分け、または次のプレイヤーのターン）に基づいて`gameStatus`を更新します。
*   **プレイヤーの切り替え：** ゲームが終了していない場合、`currentPlayer`は他のプレイヤーに切り替わります。

### 5. 勝利条件チェック（`checkWin(x, y, z)`）

これはゲームロジックの最も複雑な部分です。新しく配置されたピース`(x, y, z)`から始まる13の可能な3D方向のいずれかで、`currentPlayer`の色の4つの連続したピースをチェックします。

13の方向は：

*   **3つの軸方向：**
    *   X軸：`(1, 0, 0)`
    *   Y軸：`(0, 1, 0)`
    *   Z軸：`(0, 0, 1)`
*   **6つの平面対角線方向：**
    *   XY平面：`(1, 1, 0)`、`(1, -1, 0)`
    *   XZ平面：`(1, 0, 1)`、`(1, 0, -1)`
    *   YZ平面：`(0, 1, 1)`、`(0, 1, -1)`
*   **4つの空間対角線方向：**
    *   ` (1, 1, 1)`
    *   ` (1, 1, -1)`
    *   ` (1, -1, 1)`
    *   ` (1, -1, -1)`

`checkWin`メソッドは、これらの各方向に対して`checkLine`を呼び出します。

### 6. ラインチェック（`checkLine(x, y, z, dx, dy, dz)`）

このヘルパーメソッドは、指定された`(x, y, z)`座標から始まる特定の方向（`dx`、`dy`、`dz`）での勝利をチェックします：

*   開始点と方向によって定義されたライン沿いに反復し、開始点から正と負の両方向に最大4つの位置をチェックします。
*   `currentPlayer`の色の連続したピースをカウントします。
*   4つ以上の連続したピースが見つかった場合、`true`（勝利）を返します。
*   境界条件を処理します（`curX`、`curY`、`curZ`が0-4の範囲内に留まることを保証）。

### 7. 引き分け条件チェック（`checkDraw()`）

このメソッドはゲームが引き分けかどうかを判断します：

*   `board`上のすべてのセルを反復します。
*   空のセル（`0`）が見つかった場合、ボードが満杯ではないことを意味し、したがって引き分けではないため、`false`を返します。
*   すべてのセルが埋まっている場合（`0`が見つからない）、`true`（引き分け）を返します。

この詳細な概要は、JavaScriptとThree.jsを使用して実装されるゲームの構造とロジックの明確な理解を提供します。
